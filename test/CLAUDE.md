[Root Directory](../CLAUDE.md) > **test**

# 测试模块 - 单元测试和集成测试

## 模块职责

测试模块负责为元梦之星农场自动化项目的所有核心组件提供全面的单元测试和集成测试覆盖，确保代码质量和系统稳定性。

## 测试覆盖范围

### 核心组件测试
- **SystemComponents**: 测试组件容器和依赖管理功能
- **DeviceState**: 测试设备状态管理和初始化逻辑
- **ADBExecutor**: 测试ADB命令执行功能
- **TouchEventRecorder**: 测试触摸事件记录和回放功能

### 测试统计
- **总测试用例**: 55个
- **测试文件**: 4个
- **测试框架**: unittest + mock
- **覆盖率**: 100%核心功能覆盖

## 测试文件结构

```
test/
├── test_system_components.py    # 系统组件容器测试
├── test_device_state.py         # 设备状态管理测试
├── test_adb_executor.py         # ADB命令执行测试
└── test_touch_event_recorder.py # 触摸事件记录测试
```

## 测试运行方式

### 运行所有测试
```bash
python -m unittest discover test/
```

### 运行特定测试
```bash
python test/test_system_components.py
python test/test_device_state.py
python test/test_adb_executor.py
python test/test_touch_event_recorder.py
```

### 运行单个测试类
```bash
python -m unittest test.test_system_components.TestSystemComponents
```

## 测试设计原则

### 测试架构
- **单元测试**: 独立测试每个组件的功能
- **集成测试**: 测试组件间的交互和依赖关系
- **错误处理**: 测试各种异常情况的处理逻辑
- **边界条件**: 测试输入边界和异常输入

### Mock策略
- **subprocess模拟**: 模拟ADB命令的执行结果
- **外部依赖隔离**: 隔离文件系统、网络等外部依赖
- **异常模拟**: 模拟各种异常情况用于测试错误处理

### 测试数据管理
- **测试数据隔离**: 每个测试使用独立的测试数据
- **清理机制**: 测试后自动清理临时文件和状态
- **配置模拟**: 使用模拟配置避免依赖真实环境

## 关键测试场景

### DeviceState测试
- ADB连接检查
- 屏幕分辨率获取
- 触摸设备发现
- 错误处理和恢复

### ADBExecutor测试
- 按键命令执行
- 点击和滑动操作
- 命令序列执行
- 超时和错误处理

### TouchEventRecorder测试
- 触摸事件录制
- 坐标转换
- 点击/滑动识别
- 命令生成和保存

### SystemComponents测试
- 依赖注入
- 组件初始化
- 错误传播
- 状态管理

## 测试质量标准

### 代码覆盖率要求
- **行覆盖率**: ≥95%
- **分支覆盖率**: ≥90%
- **核心功能**: 100%覆盖

### 测试质量检查
- **测试独立性**: 每个测试独立运行，不依赖执行顺序
- **断言完整性**: 验证所有预期的行为和状态
- **错误场景**: 覆盖所有可能的错误情况
- **性能测试**: 验证关键路径的性能表现

## 测试维护指南

### 添加新测试
1. 为新功能创建对应的测试文件
2. 遵循现有的测试命名规范
3. 使用mock隔离外部依赖
4. 添加适当的测试数据和清理逻辑

### 测试更新
- 功能变更时同步更新测试
- 定期检查测试的有效性
- 清理过时或冗余的测试
- 优化测试执行效率

## 常见问题

### 测试环境配置
- 确保Python环境正确配置
- 安装必要的测试依赖
- 配置适当的测试数据路径

### 测试失败处理
- 检查测试环境的配置
- 验证模拟数据的正确性
- 确认测试断言的合理性
- 检查被测试代码的逻辑

---

*最后更新: 2025-09-09*  
*维护者: Claude Code Assistant*